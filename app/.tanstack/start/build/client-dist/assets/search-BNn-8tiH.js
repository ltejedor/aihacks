import{c as M,a as q,r as a,s as L,j as e,u as W}from"./main-DbeRoZfu.js";import{S as k}from"./SearchResults-Dda12Xuc.js";const H=q("src_utils_chat-server_ts--chatWithAI_createServerFn_handler","/_serverFn"),O=M({method:"POST"}).handler(H);function Q({initialQuery:i}){const[f,b]=a.useState([]),[C,v]=a.useState(!1),[h,y]=a.useState([]),[o,S]=a.useState(""),[d,A]=a.useState(!1),[I,F]=a.useState(i||""),[j,D]=a.useState([]),_=a.useRef([]);a.useEffect(()=>{_.current=h},[h]);const u=a.useCallback(async(t,s=!1,N=[])=>{A(!0);const x=s?`I'm searching for: "${t}". Please find relevant AI resources and explain why they're useful.`:t,g={id:Date.now().toString(),role:"user",content:x,createdAt:new Date};s||y(n=>[...n,g]);try{const n=await O({data:{messages:[...N.map(l=>({role:l.role,content:l.content})),{role:"user",content:x}]}}),m={id:(Date.now()+1).toString(),role:"assistant",content:n.text||"Search completed",createdAt:new Date,toolInvocations:[]};if(n.toolCalls&&n.toolResults){const l=n.toolCalls.map((r,w)=>{const p=n.toolResults[w];return{toolName:r.toolName,args:r.args,state:"result",result:p==null?void 0:p.result}});m.toolInvocations=l;const c=[];l.forEach(r=>{(r.toolName==="semantic_search"||r.toolName==="trending_resources")&&Array.isArray(r.result)?c.push(...r.result):r.toolName==="get_resource"&&r.result&&c.push(r.result)}),c.length>0&&(D(c),s&&b(r=>[...r,...c].filter((T,E,P)=>E===P.findIndex(z=>z.metadata.resource_id===T.metadata.resource_id))))}y(l=>[...l,m])}catch(n){console.error("Agent search error:",n)}finally{A(!1)}},[]),R=a.useCallback(async t=>{v(!0),F(t);try{const s=await L({data:t});b(s),await u(t,!0,[])}catch(s){console.error("Initial search error:",s)}finally{v(!1)}},[u]);a.useEffect(()=>{i&&R(i)},[i,R]);const $=a.useCallback(async t=>{if(t.preventDefault(),!o.trim()||d)return;const s=o.trim();S(""),await u(s,!1,_.current)},[o,d,u]);return e.jsx("div",{className:"min-h-screen bg-slate-900",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-emerald-400 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”"}),e.jsx("span",{children:"Search Results"})]}),I&&e.jsxs("div",{className:"text-slate-400 font-mono text-sm",children:['Query: "',I,'"']})]}),e.jsx("div",{className:"transition-all duration-500 ease-in-out",children:e.jsx(k,{results:f,isLoading:C})}),j.length>0&&e.jsxs("div",{className:"mt-8 animate-fadeIn",children:[e.jsxs("div",{className:"text-blue-400 font-mono text-sm mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ¤–"}),e.jsxs("span",{children:["Agent Discoveries (",j.length,")"]})]}),e.jsx("div",{className:"border-l-2 border-blue-400 pl-4",children:e.jsx(k,{results:j,isLoading:!1})})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"sticky top-8",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4 mb-4",children:[e.jsxs("h3",{className:"text-emerald-400 font-mono text-sm mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ¤–"}),e.jsx("span",{children:"AI Agent"})]}),e.jsxs("div",{className:"space-y-4 mb-4 max-h-96 overflow-y-auto",children:[h.length===0?e.jsxs("div",{className:"text-slate-400 font-mono text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{children:"ðŸ¤–"}),e.jsx("span",{children:"Agent is analyzing your search and finding relevant resources..."})]}),e.jsx("div",{className:"text-slate-500 text-xs mt-2",children:"The agent will explain its reasoning and tool choices in real-time."})]}):h.map(t=>e.jsxs("div",{className:`p-3 rounded-lg text-sm ${t.role==="user"?"bg-slate-700 border border-slate-600":"bg-slate-900 border border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-emerald-400 font-mono text-xs",children:t.role==="user"?"ðŸ‘¤ You":"ðŸ¤– Agent"}),e.jsx("span",{className:"text-slate-500 font-mono text-xs",children:t.createdAt.toLocaleTimeString()})]}),e.jsx("div",{className:"text-slate-100 text-xs leading-relaxed",children:t.content}),t.toolInvocations&&t.toolInvocations.length>0&&e.jsxs("div",{className:"mt-3 border-t border-slate-700 pt-3",children:[e.jsxs("div",{className:"text-blue-400 font-mono text-xs mb-2 flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ”§"}),e.jsxs("span",{children:["Decision Process (",t.toolInvocations.length," tools)"]})]}),t.toolInvocations.map((s,N)=>{var x,g,n,m,l,c;return e.jsxs("div",{className:"mb-2 bg-slate-800 rounded p-2 border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"text-emerald-400 font-mono text-xs flex items-center gap-1",children:[e.jsx("span",{children:"â†’"}),e.jsx("span",{children:s.toolName}),s.toolName==="semantic_search"&&e.jsx("span",{children:"ðŸ”"}),s.toolName==="trending_resources"&&e.jsx("span",{children:"ðŸ“ˆ"}),s.toolName==="get_resource"&&e.jsx("span",{children:"ðŸ“„"}),s.toolName==="reasoning"&&e.jsx("span",{children:"ðŸ§ "})]}),e.jsx("div",{className:"text-slate-500 font-mono text-xs",children:s.state==="result"&&"âœ…"})]}),e.jsxs("div",{className:"text-slate-400 font-mono text-xs mb-1",children:[s.toolName==="semantic_search"&&`Finding similar content for: "${(x=s.args)==null?void 0:x.query}"`,s.toolName==="trending_resources"&&`Analyzing trending patterns (${((g=s.args)==null?void 0:g.limit)||15} resources)`,s.toolName==="get_resource"&&`Retrieving resource: ${(n=s.args)==null?void 0:n.resourceId}`,s.toolName==="reasoning"&&`Analyzing: "${(l=(m=s.args)==null?void 0:m.thinking)==null?void 0:l.substring(0,30)}..."`]}),s.result&&Array.isArray(s.result)&&e.jsxs("div",{className:"text-slate-400 font-mono text-xs",children:[e.jsx("span",{className:"text-emerald-400",children:"Found:"})," ",s.result.length," resources",s.toolName==="semantic_search"&&((c=s.result[0])==null?void 0:c.similarity)&&e.jsxs("span",{className:"ml-2",children:["(Top match: ",(s.result[0].similarity*100).toFixed(1),"%)"]})]}),s.result&&s.toolName==="reasoning"&&e.jsxs("div",{className:"text-slate-400 font-mono text-xs",children:[e.jsx("span",{className:"text-purple-400",children:"ðŸ§  Reasoning:"})," ",s.result.confidence?`${(s.result.confidence*100).toFixed(0)}% confidence`:"Analysis complete",s.result.insights&&s.result.insights.length>0&&e.jsxs("span",{className:"ml-2",children:["(",s.result.insights.length," insights)"]})]})]},N)})]})]},t.id)),d&&e.jsxs("div",{className:"p-3 bg-slate-900 border border-slate-600 rounded-lg",children:[e.jsxs("div",{className:"text-slate-400 font-mono text-xs animate-pulse flex items-center gap-2 mb-2",children:[e.jsx("span",{children:"ðŸ¤–"}),e.jsx("span",{children:"Agent is thinking..."})]}),e.jsxs("div",{className:"text-slate-500 font-mono text-xs",children:["â€¢ Analyzing your request",e.jsx("br",{}),"â€¢ Selecting appropriate tools",e.jsx("br",{}),"â€¢ Preparing search strategy"]})]})]}),e.jsxs("form",{onSubmit:$,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:t=>S(t.target.value),placeholder:"Ask the agent...",className:"flex-1 hacker-input text-xs py-2 px-3",disabled:d}),e.jsx("button",{type:"submit",disabled:d||!o.trim(),className:"hacker-button py-2 px-3 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]})]})})})]})})})})}const G=function(){const{q:f}=W({from:"/search"});return e.jsx("div",{className:"min-h-screen bg-slate-900",children:e.jsx(Q,{initialQuery:f})})};export{G as component};
