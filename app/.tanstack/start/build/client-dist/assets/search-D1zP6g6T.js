import{c as W,a as $,r as a,s as q,j as e,u as z}from"./main-BEIYHoiB.js";import{S as _}from"./SearchResults-Bw0A_X7Y.js";const H=$("src_utils_chat-server_ts--chatWithAI_createServerFn_handler","/_serverFn"),O=W({method:"POST"}).handler(H);function Q({initialQuery:c}){const[u,f]=a.useState([]),[k,j]=a.useState(!1),[x,b]=a.useState([]),[o,v]=a.useState(""),[i,N]=a.useState(!1),[S,C]=a.useState(c||""),[p,D]=a.useState([]),y=a.useRef([]);a.useEffect(()=>{y.current=x},[x]);const m=a.useCallback(async(s,t=!1,g=[])=>{N(!0);const I=t?`I'm searching for: "${s}". Please find relevant AI resources and explain why they're useful.`:s,F={id:Date.now().toString(),role:"user",content:I,createdAt:new Date};t||b(r=>[...r,F]);try{const r=await O({data:{messages:[...g.map(l=>({role:l.role,content:l.content})),{role:"user",content:I}]}}),R={id:(Date.now()+1).toString(),role:"assistant",content:r.text||"Search completed",createdAt:new Date,toolInvocations:[]};if(r.toolCalls&&r.toolResults){const l=r.toolCalls.map((n,w)=>{const h=r.toolResults[w];return{toolName:n.toolName,args:n.args,state:"result",result:h==null?void 0:h.result}});R.toolInvocations=l;const d=[];l.forEach(n=>{(n.toolName==="semantic_search"||n.toolName==="trending_resources")&&Array.isArray(n.result)?d.push(...n.result):n.toolName==="get_resource"&&n.result&&d.push(n.result)}),d.length>0&&(D(d),t&&f(n=>[...n,...d].filter((T,M,L)=>M===L.findIndex(P=>P.metadata.resource_id===T.metadata.resource_id))))}b(l=>[...l,R])}catch(r){console.error("Agent search error:",r)}finally{N(!1)}},[]),A=a.useCallback(async s=>{j(!0),C(s);try{const t=await q({data:s});f(t),await m(s,!0,[])}catch(t){console.error("Initial search error:",t)}finally{j(!1)}},[m]);a.useEffect(()=>{c&&A(c)},[c,A]);const E=a.useCallback(async s=>{if(s.preventDefault(),!o.trim()||i)return;const t=o.trim();v(""),await m(t,!1,y.current)},[o,i,m]);return e.jsx("div",{className:"min-h-screen bg-slate-900",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-emerald-400 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”"}),e.jsx("span",{children:"Search Results"})]}),S&&e.jsxs("div",{className:"text-slate-400 font-mono text-sm",children:['Query: "',S,'"']})]}),e.jsx("div",{className:"transition-all duration-500 ease-in-out",children:e.jsx(_,{results:u,isLoading:k})}),p.length>0&&e.jsxs("div",{className:"mt-8 animate-fadeIn",children:[e.jsxs("div",{className:"text-blue-400 font-mono text-sm mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ¤–"}),e.jsxs("span",{children:["Agent Discoveries (",p.length,")"]})]}),e.jsx("div",{className:"border-l-2 border-blue-400 pl-4",children:e.jsx(_,{results:p,isLoading:!1})})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"sticky top-8",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg p-4 mb-4",children:[e.jsxs("h3",{className:"text-emerald-400 font-mono text-sm mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ¤–"}),e.jsx("span",{children:"AI Agent"})]}),e.jsxs("div",{className:"space-y-4 mb-4 max-h-96 overflow-y-auto",children:[x.length===0?e.jsx("div",{className:"text-slate-400 font-mono text-xs",children:"Agent is analyzing your search and finding relevant resources..."}):x.map(s=>e.jsxs("div",{className:`p-3 rounded-lg text-sm ${s.role==="user"?"bg-slate-700 border border-slate-600":"bg-slate-900 border border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-emerald-400 font-mono text-xs",children:s.role==="user"?"You":"Agent"}),e.jsx("span",{className:"text-slate-500 font-mono text-xs",children:s.createdAt.toLocaleTimeString()})]}),e.jsx("div",{className:"text-slate-100 text-xs leading-relaxed",children:s.content}),s.toolInvocations&&s.toolInvocations.length>0&&e.jsxs("div",{className:"mt-3 border-t border-slate-700 pt-3",children:[e.jsxs("div",{className:"text-blue-400 font-mono text-xs mb-2 flex items-center gap-1",children:[e.jsx("span",{children:"ðŸ”§"}),e.jsx("span",{children:"Tools Used"})]}),s.toolInvocations.map((t,g)=>e.jsxs("div",{className:"mb-2 bg-slate-800 rounded p-2",children:[e.jsxs("div",{className:"text-emerald-400 font-mono text-xs mb-1",children:["â†’ ",t.toolName]}),t.result&&Array.isArray(t.result)&&e.jsxs("div",{className:"text-slate-400 font-mono text-xs",children:["Found ",t.result.length," resources"]})]},g))]})]},s.id)),i&&e.jsx("div",{className:"p-3 bg-slate-900 border border-slate-600 rounded-lg",children:e.jsxs("div",{className:"text-slate-400 font-mono text-xs animate-pulse flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ¤–"}),e.jsx("span",{children:"Agent is thinking..."})]})})]}),e.jsxs("form",{onSubmit:E,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:s=>v(s.target.value),placeholder:"Ask the agent...",className:"flex-1 hacker-input text-xs py-2 px-3",disabled:i}),e.jsx("button",{type:"submit",disabled:i||!o.trim(),className:"hacker-button py-2 px-3 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]})]})})})]})})})})}const B=function(){const{q:u}=z({from:"/search"});return e.jsx("div",{className:"min-h-screen bg-slate-900",children:e.jsx(Q,{initialQuery:u})})};export{B as component};
